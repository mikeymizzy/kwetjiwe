module.exports=[61378,e=>{"use strict";var t,n,s,o,i,a,r,l,c,d,u,h,f,p,g,E,m,C,y,O,R,_,v,I,T=e.i(47909),w=e.i(74017),A=e.i(96250),N=e.i(59756),S=e.i(61916),b=e.i(14444),x=e.i(37092),M=e.i(69741),P=e.i(16795),D=e.i(87718),H=e.i(95169),U=e.i(47587),L=e.i(66012),F=e.i(70101),G=e.i(26937),j=e.i(10372),$=e.i(93695);e.i(52474);var K=e.i(220),k=e.i(89171),q=e.i(22734),B=e.i(14747);(t=f||(f={})).STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object",(n=p||(p={})).LANGUAGE_UNSPECIFIED="language_unspecified",n.PYTHON="python",(s=g||(g={})).OUTCOME_UNSPECIFIED="outcome_unspecified",s.OUTCOME_OK="outcome_ok",s.OUTCOME_FAILED="outcome_failed",s.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded";let Y=["user","model","function","system"];(o=E||(E={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",o.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",o.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",o.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",o.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",(i=m||(m={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE",(a=C||(C={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",a.NEGLIGIBLE="NEGLIGIBLE",a.LOW="LOW",a.MEDIUM="MEDIUM",a.HIGH="HIGH",(r=y||(y={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",r.SAFETY="SAFETY",r.OTHER="OTHER",(l=O||(O={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",l.STOP="STOP",l.MAX_TOKENS="MAX_TOKENS",l.SAFETY="SAFETY",l.RECITATION="RECITATION",l.LANGUAGE="LANGUAGE",l.OTHER="OTHER",(c=R||(R={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",c.RETRIEVAL_QUERY="RETRIEVAL_QUERY",c.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",c.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",c.CLASSIFICATION="CLASSIFICATION",c.CLUSTERING="CLUSTERING",(d=_||(_={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",d.AUTO="AUTO",d.ANY="ANY",d.NONE="NONE",(u=v||(v={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",u.MODE_DYNAMIC="MODE_DYNAMIC";class V extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class J extends V{constructor(e,t){super(e),this.response=t}}class X extends V{constructor(e,t,n,s){super(e),this.status=t,this.statusText=n,this.errorDetails=s}}class W extends V{}(h=I||(I={})).GENERATE_CONTENT="generateContent",h.STREAM_GENERATE_CONTENT="streamGenerateContent",h.COUNT_TOKENS="countTokens",h.EMBED_CONTENT="embedContent",h.BATCH_EMBED_CONTENTS="batchEmbedContents";class Q{constructor(e,t,n,s,o){this.model=e,this.task=t,this.apiKey=n,this.stream=s,this.requestOptions=o}toString(){var e,t;let n=(null==(e=this.requestOptions)?void 0:e.apiVersion)||"v1beta",s=(null==(t=this.requestOptions)?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",o=`${s}/${n}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}async function z(e){var t,n;let s,o=new Headers;o.append("Content-Type","application/json"),o.append("x-goog-api-client",(n=e.requestOptions,s=[],(null==n?void 0:n.apiClient)&&s.push(n.apiClient),s.push("genai-js/0.21.0"),s.join(" "))),o.append("x-goog-api-key",e.apiKey);let i=null==(t=e.requestOptions)?void 0:t.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(e){throw new W(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${e.message}`)}for(let[e,t]of i.entries()){if("x-goog-api-key"===e)throw new W(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new W(`Header name ${e} can only be set using the apiClient field`);o.append(e,t)}}return o}async function Z(e,t,n,s,o,i){let a=new Q(e,t,n,s,i);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.signal)!==void 0||(null==e?void 0:e.timeout)>=0){let n=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}(i)),{method:"POST",headers:await z(a),body:o})}}async function ee(e,t,n,s,o,i={},a=fetch){let{url:r,fetchOptions:l}=await Z(e,t,n,s,o,i);return et(r,l,a)}async function et(e,t,n=fetch){let s;try{s=await n(e,t)}catch(n){var o=n,i=e;let t=o;throw o instanceof X||o instanceof W||((t=new V(`Error fetching from ${i.toString()}: ${o.message}`)).stack=o.stack),t}return s.ok||await en(s,e),s}async function en(e,t){let n,s="";try{let t=await e.json();s=t.error.message,t.error.details&&(s+=` ${JSON.stringify(t.error.details)}`,n=t.error.details)}catch(e){}throw new X(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${s}`,e.status,e.statusText,n)}function es(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),ea(e.candidates[0]))throw new J(`${er(e)}`,e);return function(e){var t,n,s,o;let i=[];if(null==(n=null==(t=e.candidates)?void 0:t[0].content)?void 0:n.parts)for(let t of null==(o=null==(s=e.candidates)?void 0:s[0].content)?void 0:o.parts)t.text&&i.push(t.text),t.executableCode&&i.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&i.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}(e)}if(e.promptFeedback)throw new J(`Text not available. ${er(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ea(e.candidates[0]))throw new J(`${er(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),eo(e)[0]}if(e.promptFeedback)throw new J(`Function call not available. ${er(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ea(e.candidates[0]))throw new J(`${er(e)}`,e);return eo(e)}if(e.promptFeedback)throw new J(`Function call not available. ${er(e)}`,e)},e}function eo(e){var t,n,s,o;let i=[];if(null==(n=null==(t=e.candidates)?void 0:t[0].content)?void 0:n.parts)for(let t of null==(o=null==(s=e.candidates)?void 0:s[0].content)?void 0:o.parts)t.functionCall&&i.push(t.functionCall);return i.length>0?i:void 0}let ei=[O.RECITATION,O.SAFETY,O.LANGUAGE];function ea(e){return!!e.finishReason&&ei.includes(e.finishReason)}function er(e){var t,n,s;let o="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)o+="Response was blocked",(null==(t=e.promptFeedback)?void 0:t.blockReason)&&(o+=` due to ${e.promptFeedback.blockReason}`),(null==(n=e.promptFeedback)?void 0:n.blockReasonMessage)&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null==(s=e.candidates)?void 0:s[0]){let t=e.candidates[0];ea(t)&&(o+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(o+=`: ${t.finishMessage}`))}return o}function el(e){return this instanceof el?(this.v=e,this):new el(e)}"function"==typeof SuppressedError&&SuppressedError;let ec=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function ed(e){let t=[],n=e.getReader();for(;;){let{done:e,value:s}=await n.read();if(e)return es(function(e){let t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates)for(let e of t.candidates){let t=e.index;if(n.candidates||(n.candidates=[]),n.candidates[t]||(n.candidates[t]={index:e.index}),n.candidates[t].citationMetadata=e.citationMetadata,n.candidates[t].groundingMetadata=e.groundingMetadata,n.candidates[t].finishReason=e.finishReason,n.candidates[t].finishMessage=e.finishMessage,n.candidates[t].safetyRatings=e.safetyRatings,e.content&&e.content.parts){n.candidates[t].content||(n.candidates[t].content={role:e.content.role||"user",parts:[]});let s={};for(let o of e.content.parts)o.text&&(s.text=o.text),o.functionCall&&(s.functionCall=o.functionCall),o.executableCode&&(s.executableCode=o.executableCode),o.codeExecutionResult&&(s.codeExecutionResult=o.codeExecutionResult),0===Object.keys(s).length&&(s.text=""),n.candidates[t].content.parts.push(s)}}t.usageMetadata&&(n.usageMetadata=t.usageMetadata)}return n}(t));t.push(s)}}async function eu(e,t,n,s){return function(e){let t,[n,s]=(t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})).getReader(),new ReadableStream({start(e){let n="";return function s(){return t.read().then(({value:t,done:o})=>{let i;if(o)return n.trim()?void e.error(new V("Failed to parse stream")):void e.close();let a=(n+=t).match(ec);for(;a;){try{i=JSON.parse(a[1])}catch(t){e.error(new V(`Error parsing JSON response: "${a[1]}"`));return}e.enqueue(i),a=(n=n.substring(a[0].length)).match(ec)}return s()})}()}})).tee();return{stream:function(e){return function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,o=n.apply(e,t||[]),i=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(e){o[e]&&(s[e]=function(t){return new Promise(function(n,s){i.push([e,t,n,s])>1||r(e,t)})})}function r(e,t){try{var n;(n=o[e](t)).value instanceof el?Promise.resolve(n.value.v).then(l,c):d(i[0][2],n)}catch(e){d(i[0][3],e)}}function l(e){r("next",e)}function c(e){r("throw",e)}function d(e,t){e(t),i.shift(),i.length&&r(i[0][0],i[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:n}=yield el(t.read());if(n)break;yield yield el(es(e))}})}(n),response:ed(s)}}(await ee(t,I.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),s))}async function eh(e,t,n,s){let o=await ee(t,I.GENERATE_CONTENT,e,!1,JSON.stringify(n),s);return{response:es(await o.json())}}function ef(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)if(!e.role)return{role:"system",parts:e.parts};else return e}}function ep(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let n of e)"string"==typeof n?t.push({text:n}):t.push(n);var n=t;let s={role:"user",parts:[]},o={role:"function",parts:[]},i=!1,a=!1;for(let e of n)"functionResponse"in e?(o.parts.push(e),a=!0):(s.parts.push(e),i=!0);if(i&&a)throw new V("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!a)throw new V("No content is provided for sending chat message.");return i?s:o}function eg(e){let t;return t=e.contents?e:{contents:[ep(e)]},e.systemInstruction&&(t.systemInstruction=ef(e.systemInstruction)),t}let eE=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],em={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]},eC="SILENT_ERROR";class ey{constructor(e,t,n,s={}){this.model=t,this.params=n,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(!function(e){let t=!1;for(let n of e){let{role:e,parts:s}=n;if(!t&&"user"!==e)throw new V(`First content should be with role 'user', got ${e}`);if(!Y.includes(e))throw new V(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(Y)}`);if(!Array.isArray(s))throw new V("Content should have 'parts' property with an array of Parts");if(0===s.length)throw new V("Each Content should have at least one part");let o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of s)for(let t of eE)t in e&&(o[t]+=1);let i=em[e];for(let t of eE)if(!i.includes(t)&&o[t]>0)throw new V(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,s,o,i,a,r;let l;await this._sendPromise;let c=ep(e),d={safetySettings:null==(n=this.params)?void 0:n.safetySettings,generationConfig:null==(s=this.params)?void 0:s.generationConfig,tools:null==(o=this.params)?void 0:o.tools,toolConfig:null==(i=this.params)?void 0:i.toolConfig,systemInstruction:null==(a=this.params)?void 0:a.systemInstruction,cachedContent:null==(r=this.params)?void 0:r.cachedContent,contents:[...this._history,c]},u=Object.assign(Object.assign({},this._requestOptions),t);return this._sendPromise=this._sendPromise.then(()=>eh(this._apiKey,this.model,d,u)).then(e=>{var t;if(e.response.candidates&&e.response.candidates.length>0){this._history.push(c);let n=Object.assign({parts:[],role:"model"},null==(t=e.response.candidates)?void 0:t[0].content);this._history.push(n)}else{let t=er(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}l=e}),await this._sendPromise,l}async sendMessageStream(e,t={}){var n,s,o,i,a,r;await this._sendPromise;let l=ep(e),c={safetySettings:null==(n=this.params)?void 0:n.safetySettings,generationConfig:null==(s=this.params)?void 0:s.generationConfig,tools:null==(o=this.params)?void 0:o.tools,toolConfig:null==(i=this.params)?void 0:i.toolConfig,systemInstruction:null==(a=this.params)?void 0:a.systemInstruction,cachedContent:null==(r=this.params)?void 0:r.cachedContent,contents:[...this._history,l]},d=Object.assign(Object.assign({},this._requestOptions),t),u=eu(this._apiKey,this.model,c,d);return this._sendPromise=this._sendPromise.then(()=>u).catch(e=>{throw Error(eC)}).then(e=>e.response).then(e=>{if(e.candidates&&e.candidates.length>0){this._history.push(l);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=er(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==eC&&console.error(e)}),u}}async function eO(e,t,n,s){return(await ee(t,I.COUNT_TOKENS,e,!1,JSON.stringify(n),s)).json()}async function eR(e,t,n,s){return(await ee(t,I.EMBED_CONTENT,e,!1,JSON.stringify(n),s)).json()}async function e_(e,t,n,s){let o=n.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await ee(t,I.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:o}),s)).json()}class ev{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=ef(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;let s=eg(e),o=Object.assign(Object.assign({},this._requestOptions),t);return eh(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(n=this.cachedContent)?void 0:n.name},s),o)}async generateContentStream(e,t={}){var n;let s=eg(e),o=Object.assign(Object.assign({},this._requestOptions),t);return eu(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(n=this.cachedContent)?void 0:n.name},s),o)}startChat(e){var t;return new ey(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(t=this.cachedContent)?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let n=function(e,t){var n;let s={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null==(n=null==t?void 0:t.cachedContent)?void 0:n.name,contents:[]},o=null!=e.generateContentRequest;if(e.contents){if(o)throw new W("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=e.contents}else if(o)s=Object.assign(Object.assign({},s),e.generateContentRequest);else{let t=ep(e);s.contents=[t]}return{generateContentRequest:s}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return eO(this.apiKey,this.model,n,s)}async embedContent(e,t={}){let n="string"==typeof e||Array.isArray(e)?{content:ep(e)}:e,s=Object.assign(Object.assign({},this._requestOptions),t);return eR(this.apiKey,this.model,n,s)}async batchEmbedContents(e,t={}){let n=Object.assign(Object.assign({},this._requestOptions),t);return e_(this.apiKey,this.model,e,n)}}class eI{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new V("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new ev(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new W("Cached content must contain a `name` field.");if(!e.model)throw new W("Cached content must contain a `model` field.");for(let n of["model","systemInstruction"])if((null==t?void 0:t[n])&&e[n]&&(null==t?void 0:t[n])!==e[n]){if("model"===n&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new W(`Different value for "${n}" specified in modelParams (${t[n]}) and cachedContent (${e[n]})`)}let s=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new ev(this.apiKey,s,n)}}async function eT(e){if(!process.env.GOOGLE_GEMINI_API_KEY)return k.NextResponse.json({error:"Gemini API key is not configured."},{status:500});let t=(await e.json().catch(()=>({}))).messages??[],n=function(){try{let e=B.default.join(process.cwd(),"public","Company Profile Kwetjiwe.pdf");return q.default.readFileSync(e).toString("base64")}catch{return null}}();try{let e=new eI(process.env.GOOGLE_GEMINI_API_KEY).getGenerativeModel({model:"gemini-1.5-flash"}),s=t.map(e=>({role:"assistant"===e.role?"model":"user",parts:[{text:e.content}]}));s.unshift({role:"user",parts:[{text:"You are the AI assistant for Kwetjiwe Consulting (Pty) Ltd, a business and financial solutions company that bridges clients and funders. Services include business development, transaction advisory, capital raising, restructuring, and executive mentorship. They operate as a subsidiary of Bodibe Ba Thaba Holdings and support clients across sectors, including hospitality, franchises, student housing, and more. Use factual info from the company profile PDF (attached) and the website context above. If information is missing, say you do not have that detail."},n?{inlineData:{mimeType:"application/pdf",data:n}}:{text:"Company profile PDF not found on the server."}]});let o=await e.generateContent({contents:s}),i=o.response?.text()??"I wasn't able to produce an answer.";return k.NextResponse.json({reply:i})}catch(e){return console.error("Gemini chat error:",e),k.NextResponse.json({error:"Unable to process your request right now."},{status:500})}}e.s(["POST",()=>eT],76021);var ew=e.i(76021);let eA=new T.AppRouteRouteModule({definition:{kind:w.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/chat/route.ts",nextConfigOutput:"",userland:ew}),{workAsyncStorage:eN,workUnitAsyncStorage:eS,serverHooks:eb}=eA;function ex(){return(0,A.patchFetch)({workAsyncStorage:eN,workUnitAsyncStorage:eS})}async function eM(e,t,n){eA.isDev&&(0,N.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/chat/route";s=s.replace(/\/index$/,"")||"/";let o=await eA.prepare(e,t,{srcPage:s,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:i,params:a,nextConfig:r,parsedUrl:l,isDraftMode:c,prerenderManifest:d,routerServerContext:u,isOnDemandRevalidate:h,revalidateOnlyGenerated:f,resolvedPathname:p,clientReferenceManifest:g,serverActionsManifest:E}=o,m=(0,M.normalizeAppPath)(s),C=!!(d.dynamicRoutes[m]||d.routes[p]),y=async()=>((null==u?void 0:u.render404)?await u.render404(e,t,l,!1):t.end("This page could not be found"),null);if(C&&!c){let e=!!d.routes[p],t=d.dynamicRoutes[m];if(t&&!1===t.fallback&&!e){if(r.experimental.adapterPath)return await y();throw new $.NoFallbackError}}let O=null;!C||eA.isDev||c||(O="/index"===(O=p)?"/":O);let R=!0===eA.isDev||!C,_=C&&!R;E&&g&&(0,b.setReferenceManifestsSingleton)({page:s,clientReferenceManifest:g,serverActionsManifest:E,serverModuleMap:(0,x.createServerModuleMap)({serverActionsManifest:E})});let v=e.method||"GET",I=(0,S.getTracer)(),T=I.getActiveScopeSpan(),A={params:a,prerenderManifest:d,renderOpts:{experimental:{authInterrupts:!!r.experimental.authInterrupts},cacheComponents:!!r.cacheComponents,supportsDynamicResponse:R,incrementalCache:(0,N.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:r.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,s)=>eA.onRequestError(e,t,s,u)},sharedContext:{buildId:i}},k=new P.NodeNextRequest(e),q=new P.NodeNextResponse(t),B=D.NextRequestAdapter.fromNodeNextRequest(k,(0,D.signalFromNodeResponse)(t));try{let o=async e=>eA.handle(B,A).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=I.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==H.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=n.get("next.route");if(o){let t=`${v} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${v} ${s}`)}),i=!!(0,N.getRequestMeta)(e,"minimalMode"),a=async a=>{var l,p;let g=async({previousCacheEntry:r})=>{try{if(!i&&h&&f&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(a);e.fetchMetrics=A.renderOpts.fetchMetrics;let l=A.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let c=A.renderOpts.collectedTags;if(!C)return await (0,L.sendResponse)(k,q,s,A.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,F.toNodeOutgoingHttpHeaders)(s.headers);c&&(t[j.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==A.renderOpts.collectedRevalidate&&!(A.renderOpts.collectedRevalidate>=j.INFINITE_CACHE)&&A.renderOpts.collectedRevalidate,o=void 0===A.renderOpts.collectedExpire||A.renderOpts.collectedExpire>=j.INFINITE_CACHE?void 0:A.renderOpts.collectedExpire;return{value:{kind:K.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:o}}}}catch(t){throw(null==r?void 0:r.isStale)&&await eA.onRequestError(e,t,{routerKind:"App Router",routePath:s,routeType:"route",revalidateReason:(0,U.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:h})},u),t}},E=await eA.handleResponse({req:e,nextConfig:r,cacheKey:O,routeKind:w.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:d,isRoutePPREnabled:!1,isOnDemandRevalidate:h,revalidateOnlyGenerated:f,responseGenerator:g,waitUntil:n.waitUntil,isMinimalMode:i});if(!C)return null;if((null==E||null==(l=E.value)?void 0:l.kind)!==K.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==E||null==(p=E.value)?void 0:p.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",h?"REVALIDATED":E.isMiss?"MISS":E.isStale?"STALE":"HIT"),c&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,F.fromNodeOutgoingHttpHeaders)(E.value.headers);return i&&C||m.delete(j.NEXT_CACHE_TAGS_HEADER),!E.cacheControl||t.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,G.getCacheControlHeader)(E.cacheControl)),await (0,L.sendResponse)(k,q,new Response(E.value.body,{headers:m,status:E.value.status||200})),null};T?await a(T):await I.withPropagatedContext(e.headers,()=>I.trace(H.BaseServerSpan.handleRequest,{spanName:`${v} ${s}`,kind:S.SpanKind.SERVER,attributes:{"http.method":v,"http.target":e.url}},a))}catch(t){if(t instanceof $.NoFallbackError||await eA.onRequestError(e,t,{routerKind:"App Router",routePath:m,routeType:"route",revalidateReason:(0,U.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:h})}),C)throw t;return await (0,L.sendResponse)(k,q,new Response(null,{status:500})),null}}e.s(["handler",()=>eM,"patchFetch",()=>ex,"routeModule",()=>eA,"serverHooks",()=>eb,"workAsyncStorage",()=>eN,"workUnitAsyncStorage",()=>eS],61378)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_371d0bff.js.map